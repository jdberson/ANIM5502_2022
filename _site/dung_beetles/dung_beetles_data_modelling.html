<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.132">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>ANIM5502 2022 Data analyses - Data modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../dung_beetles/dung_beetles_data_exploration.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Data modelling</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">ANIM5502 2022 Data analyses</a> 
        <div class="sidebar-tools-main">
    <a href="" title="" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-github"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/jdberson/ANIM5502_2022">
          Source code
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/jdberson/ANIM5502_2022/issues">
          Report a bug
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../dung_beetles/dung_beetles_index.html" class="sidebar-item-text sidebar-link">Dung beetles</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dung_beetles/dung_beetles_data_cleaning.html" class="sidebar-item-text sidebar-link">Data cleaning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dung_beetles/dung_beetles_data_exploration.html" class="sidebar-item-text sidebar-link">Data exploration</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dung_beetles/dung_beetles_data_modelling.html" class="sidebar-item-text sidebar-link active">Data modelling</a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li>
<a href="#hypothesis-1a" id="toc-hypothesis-1a" class="nav-link" data-scroll-target="#hypothesis-1a">Hypothesis #1a</a>
  <ul class="collapse">
<li><a href="#step-1-pepare-the-data" id="toc-step-1-pepare-the-data" class="nav-link" data-scroll-target="#step-1-pepare-the-data">Step 1: pepare the data</a></li>
  <li><a href="#step-2-fit-the-model" id="toc-step-2-fit-the-model" class="nav-link" data-scroll-target="#step-2-fit-the-model">Step 2: fit the model</a></li>
  <li><a href="#step-3-check-model-assumptions" id="toc-step-3-check-model-assumptions" class="nav-link" data-scroll-target="#step-3-check-model-assumptions">Step 3: check model assumptions</a></li>
  <li><a href="#step-4-look-at-model-results" id="toc-step-4-look-at-model-results" class="nav-link" data-scroll-target="#step-4-look-at-model-results">Step 4: look at model results</a></li>
  <li><a href="#step-5-understand-the-model-results" id="toc-step-5-understand-the-model-results" class="nav-link" data-scroll-target="#step-5-understand-the-model-results">Step 5: understand the model results</a></li>
  <li><a href="#step-6-visualise-model-predictions-alongside-raw-data" id="toc-step-6-visualise-model-predictions-alongside-raw-data" class="nav-link" data-scroll-target="#step-6-visualise-model-predictions-alongside-raw-data">Step 6: visualise model predictions alongside raw data</a></li>
  </ul>
</li>
  <li>
<a href="#hypothesis-1b" id="toc-hypothesis-1b" class="nav-link" data-scroll-target="#hypothesis-1b">Hypothesis #1b</a>
  <ul class="collapse">
<li><a href="#step-1-prepare-the-data" id="toc-step-1-prepare-the-data" class="nav-link" data-scroll-target="#step-1-prepare-the-data">Step 1: prepare the data</a></li>
  <li><a href="#step-2-fit-the-model-1" id="toc-step-2-fit-the-model-1" class="nav-link" data-scroll-target="#step-2-fit-the-model-1">Step 2: fit the model</a></li>
  <li><a href="#step-3-check-model-assumptions-1" id="toc-step-3-check-model-assumptions-1" class="nav-link" data-scroll-target="#step-3-check-model-assumptions-1">Step 3: check model assumptions</a></li>
  <li><a href="#step-4-look-at-model-results-1" id="toc-step-4-look-at-model-results-1" class="nav-link" data-scroll-target="#step-4-look-at-model-results-1">Step 4: look at model results</a></li>
  <li><a href="#step-5-understand-the-model-results-1" id="toc-step-5-understand-the-model-results-1" class="nav-link" data-scroll-target="#step-5-understand-the-model-results-1">Step 5: understand the model results</a></li>
  <li><a href="#step-6-visualise-model-predictions-alongside-raw-data-1" id="toc-step-6-visualise-model-predictions-alongside-raw-data-1" class="nav-link" data-scroll-target="#step-6-visualise-model-predictions-alongside-raw-data-1">Step 6: visualise model predictions alongside raw data</a></li>
  </ul>
</li>
  <li>
<a href="#hypothesis-2" id="toc-hypothesis-2" class="nav-link" data-scroll-target="#hypothesis-2">Hypothesis #2</a>
  <ul class="collapse">
<li><a href="#step-1-prepare-the-data-1" id="toc-step-1-prepare-the-data-1" class="nav-link" data-scroll-target="#step-1-prepare-the-data-1">Step 1: prepare the data</a></li>
  <li><a href="#step-2-fit-the-model-2" id="toc-step-2-fit-the-model-2" class="nav-link" data-scroll-target="#step-2-fit-the-model-2">Step 2: fit the model</a></li>
  <li><a href="#step-3-check-model-assumptions-2" id="toc-step-3-check-model-assumptions-2" class="nav-link" data-scroll-target="#step-3-check-model-assumptions-2">Step 3: check model assumptions</a></li>
  <li><a href="#step-4-look-at-model-results-2" id="toc-step-4-look-at-model-results-2" class="nav-link" data-scroll-target="#step-4-look-at-model-results-2">Step 4: look at model results</a></li>
  <li><a href="#step-5-understand-the-model-results-2" id="toc-step-5-understand-the-model-results-2" class="nav-link" data-scroll-target="#step-5-understand-the-model-results-2">Step 5: understand the model results</a></li>
  <li><a href="#step-6-visualise-model-predictions-alongside-raw-data-2" id="toc-step-6-visualise-model-predictions-alongside-raw-data-2" class="nav-link" data-scroll-target="#step-6-visualise-model-predictions-alongside-raw-data-2">Step 6: visualise model predictions alongside raw data</a></li>
  </ul>
</li>
  <li>
<a href="#hypothesis-3" id="toc-hypothesis-3" class="nav-link" data-scroll-target="#hypothesis-3">Hypothesis #3</a>
  <ul class="collapse">
<li><a href="#step-1-prepare-the-data-2" id="toc-step-1-prepare-the-data-2" class="nav-link" data-scroll-target="#step-1-prepare-the-data-2">Step 1: prepare the data</a></li>
  <li><a href="#step-2-fit-the-model-3" id="toc-step-2-fit-the-model-3" class="nav-link" data-scroll-target="#step-2-fit-the-model-3">Step 2: fit the model</a></li>
  <li><a href="#step-3-check-model-assumptions-3" id="toc-step-3-check-model-assumptions-3" class="nav-link" data-scroll-target="#step-3-check-model-assumptions-3">Step 3: check model assumptions</a></li>
  <li><a href="#step-4-look-at-model-results-3" id="toc-step-4-look-at-model-results-3" class="nav-link" data-scroll-target="#step-4-look-at-model-results-3">Step 4: look at model results</a></li>
  <li><a href="#step-5-understand-the-model-results-3" id="toc-step-5-understand-the-model-results-3" class="nav-link" data-scroll-target="#step-5-understand-the-model-results-3">Step 5: understand the model results</a></li>
  <li><a href="#step-6-visualise-e-raw-data" id="toc-step-6-visualise-e-raw-data" class="nav-link" data-scroll-target="#step-6-visualise-e-raw-data">Step 6: visualise e raw data</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jdberson/ANIM5502_2022/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">Data modelling</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><section id="setup" class="level2"><h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Here we load the packages, set the ggplot theme and load the data.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://broom.tidymodels.org/">"broom"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bbolker/broom.mixed">"broom.mixed"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rvlenth/emmeans">"emmeans"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/">"lme4"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://r-forge.r-project.org/projects/car/">"car"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set the ggplot theme for all plots.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_update</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size<span class="op">=</span><span class="fl">10</span>, hjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>             strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey80"</span>, colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>             axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>             axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the data.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Read in the data</span></span>
<span><span class="va">db_data</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/db_data.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># Some R packages require factors to be explicit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">id</span><span class="op">:</span><span class="va">shipment</span>, <span class="va">treatment</span><span class="op">:</span><span class="va">sex</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="hypothesis-1a" class="level2"><h2 class="anchored" data-anchor-id="hypothesis-1a">Hypothesis #1a</h2>
<p>First we want to know whether the treatment had an immediate effect on beetle morphology, and whether this effect differed for the two species.</p>
<p>Recall from our data exploration that two of the <em>Onthophagus vacca</em> shipments did not have both treatments. We will filter these out for this analysis, as well as generations other than the first generation.</p>
<p>Here, we first look at the effect on <strong>pronotum width</strong>.</p>
<section id="step-1-pepare-the-data" class="level3"><h3 class="anchored" data-anchor-id="step-1-pepare-the-data">Step 1: pepare the data</h3>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filter data</span></span>
<span><span class="va">db_data_F1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">db_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">generation</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>                     <span class="op">!</span><span class="va">shipment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"5A"</span>, <span class="st">"5B"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check sample sizes</span></span>
<span><span class="va">db_data_F1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">pronotum_width</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">sex</span>, <span class="va">shipment</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["treatment"],"name":[1],"type":["fct"],"align":["left"]},{"label":["sex"],"name":[2],"type":["fct"],"align":["left"]},{"label":["shipment"],"name":[3],"type":["fct"],"align":["left"]},{"label":["species"],"name":[4],"type":["fct"],"align":["left"]},{"label":["n"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"CT","2":"F","3":"2","4":"Onthophagus vacca","5":"20"},{"1":"CT","2":"F","3":"4","4":"Onthophagus vacca","5":"25"},{"1":"CT","2":"F","3":"8","4":"Onthophagus andalusicus","5":"20"},{"1":"CT","2":"F","3":"9","4":"Onthophagus andalusicus","5":"20"},{"1":"CT","2":"M","3":"2","4":"Onthophagus vacca","5":"10"},{"1":"CT","2":"M","3":"4","4":"Onthophagus vacca","5":"25"},{"1":"CT","2":"M","3":"8","4":"Onthophagus andalusicus","5":"20"},{"1":"CT","2":"M","3":"9","4":"Onthophagus andalusicus","5":"20"},{"1":"Q","2":"F","3":"2","4":"Onthophagus vacca","5":"40"},{"1":"Q","2":"F","3":"4","4":"Onthophagus vacca","5":"10"},{"1":"Q","2":"F","3":"8","4":"Onthophagus andalusicus","5":"20"},{"1":"Q","2":"F","3":"9","4":"Onthophagus andalusicus","5":"14"},{"1":"Q","2":"M","3":"2","4":"Onthophagus vacca","5":"40"},{"1":"Q","2":"M","3":"4","4":"Onthophagus vacca","5":"10"},{"1":"Q","2":"M","3":"8","4":"Onthophagus andalusicus","5":"20"},{"1":"Q","2":"M","3":"9","4":"Onthophagus andalusicus","5":"8"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="step-2-fit-the-model" class="level3"><h3 class="anchored" data-anchor-id="step-2-fit-the-model">Step 2: fit the model</h3>
<p>Here we fit the model that tests whether there is a treatment effect on pronotum width, if this differs by species (treatment*species term), if males and females differ in their pronotum width (sex term) and whether there were any differences among the different shipments (the (1|shipment) random effect term).</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">m1_pw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">pronotum_width</span> <span class="op">~</span> <span class="va">treatment</span><span class="op">*</span><span class="va">species</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">shipment</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">db_data_F1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="step-3-check-model-assumptions" class="level3"><h3 class="anchored" data-anchor-id="step-3-check-model-assumptions">Step 3: check model assumptions</h3>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fitted vs residuals plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m1_pw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Histogram of residuals</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m1_pw</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Those diagnostic plots look OK to me.</p>
</section><section id="step-4-look-at-model-results" class="level3"><h3 class="anchored" data-anchor-id="step-4-look-at-model-results">Step 4: look at model results</h3>
<p>Now that we have fit our model and checked that the model assumptions look OK, we want to know the answer to the questions we are asking our model to investigate (see above).</p>
<p>We will use the Anova function from the car package (notice the capital ‘A’) to test the statistical significance for each model term.</p>
<p><strong>Important</strong> There are lots of problems with <em>P</em> values and null hypothesis significance testing. These are important to be aware of but that is not the focus of this unit. We can discuss these during our next meeting.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">m1_pw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"6.076304e+01","2":"1","3":"6.437523e-15","_rn_":"treatment"},{"1":"6.087242e-04","2":"1","3":"9.803163e-01","_rn_":"species"},{"1":"3.638679e-02","2":"1","3":"8.487189e-01","_rn_":"sex"},{"1":"2.800405e+01","2":"1","3":"1.210616e-07","_rn_":"treatment:species"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="step-5-understand-the-model-results" class="level3"><h3 class="anchored" data-anchor-id="step-5-understand-the-model-results">Step 5: understand the model results</h3>
<p>Our model is telling us that we have evidence for an effect of treatment on pronotum width and that this effect depends on the species being measured (statistically significant treatment:species term).</p>
<p>What is difficult to understand from the model output is <em>how</em> the treatment is affecting pronotum width and <em>how</em> this effect differs for each species.</p>
<p>To understand these effects we can look at the estimated marginal means:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m1_pw_emm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">m1_pw</span>, <span class="op">~</span><span class="va">treatment</span><span class="op">*</span><span class="va">species</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Test for a treatment effect for each species separately</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/contrast.html">contrast</a></span><span class="op">(</span><span class="va">m1_pw_emm</span>, by <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["species"],"name":[1],"type":["chr"],"align":["left"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["contrast"],"name":[3],"type":["chr"],"align":["left"]},{"label":["null.value"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["adj.p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"Onthophagus andalusicus","2":"treatment","3":"CT effect","4":"0","5":"-0.30668351","6":"0.03323819","7":"315.0644","8":"-9.226840","9":"4.165179e-18"},{"1":"Onthophagus andalusicus","2":"treatment","3":"Q effect","4":"0","5":"0.30668351","6":"0.03323819","7":"315.0644","8":"9.226840","9":"4.165179e-18"},{"1":"Onthophagus vacca","2":"treatment","3":"CT effect","4":"0","5":"-0.06082038","6":"0.03241196","7":"315.5278","8":"-1.876479","9":"6.151233e-02"},{"1":"Onthophagus vacca","2":"treatment","3":"Q effect","4":"0","5":"0.06082038","6":"0.03241196","7":"315.5278","8":"1.876479","9":"6.151233e-02"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We can see that for both species those beetles in the CT treatment tend to be smaller, but that this effect is larger for <em>Onthophagus andalusicus</em>.</p>
</section><section id="step-6-visualise-model-predictions-alongside-raw-data" class="level3"><h3 class="anchored" data-anchor-id="step-6-visualise-model-predictions-alongside-raw-data">Step 6: visualise model predictions alongside raw data</h3>
<p>So far this has been all very ‘black box’ - we have run a model and got some results. We have some idea of what the model is telling us, but how well does the model reflect the raw data? It’s also often much easier to communicate our results using a figure rather than just numbers in a table.</p>
<p>The following figure plots the the mean pronotum width for each species/treatment combination that is predicted by the model, the standard errors for these means, along with the raw data points.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Notice the use of tidy() from the generics package</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">m1_pw_emm</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">estimate</span>, colour <span class="op">=</span> <span class="va">treatment</span>, shape <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="va">std.error</span>, ymax <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="va">std.error</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">db_data_F1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, y <span class="op">=</span> <span class="va">pronotum_width</span>, colour <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># The following line could be used to change the colours</span></span>
<span>  <span class="co">#scale_colour_viridis_d() +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">species</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Pronotum width (mm)"</span>, x <span class="op">=</span> <span class="st">"Treament"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="hypothesis-1b" class="level2"><h2 class="anchored" data-anchor-id="hypothesis-1b">Hypothesis #1b</h2>
<p>Above we looked at pronotum width, now let’s ask the same questions but examining <strong>head horns</strong>. Because head horn size will increase with pronotum width, we want to look at the size of the horn <em>relative</em> to body size. To do this we simply include pronotum_width as another explanatory variable.</p>
<p>We will follow the same steps as we did with pronotum width…</p>
<section id="step-1-prepare-the-data" class="level3"><h3 class="anchored" data-anchor-id="step-1-prepare-the-data">Step 1: prepare the data</h3>
<p>Already done! Move to step 2.</p>
</section><section id="step-2-fit-the-model-1" class="level3"><h3 class="anchored" data-anchor-id="step-2-fit-the-model-1">Step 2: fit the model</h3>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">m1_hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">head_horn</span> <span class="op">~</span> <span class="va">pronotum_width</span> <span class="op">+</span> <span class="va">treatment</span><span class="op">*</span><span class="va">species</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">shipment</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">db_data_F1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<p>You will see we get an error: boundary (singular) fit: see help(‘isSingular’).</p>
<p>This is not an uncommon error, and seems to be happening because there is no variation associated with ‘shipment’. Increasing our sample size may help with this. For now I think it’s fine to push on.</p>
</section><section id="step-3-check-model-assumptions-1" class="level3"><h3 class="anchored" data-anchor-id="step-3-check-model-assumptions-1">Step 3: check model assumptions</h3>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Fitted vs residuals plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m1_hh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Histogram of residuals</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m1_hh</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These plots don’t look wonderful but I think they are OK for our purposes.</p>
</section><section id="step-4-look-at-model-results-1" class="level3"><h3 class="anchored" data-anchor-id="step-4-look-at-model-results-1">Step 4: look at model results</h3>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">m1_hh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"487.532463","2":"1","3":"4.905947e-108","_rn_":"pronotum_width"},{"1":"4.247608","2":"1","3":"3.930565e-02","_rn_":"treatment"},{"1":"95.378283","2":"1","3":"1.572695e-22","_rn_":"species"},{"1":"5.901039","2":"1","3":"1.513196e-02","_rn_":"treatment:species"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The model is suggesting that there is a treatment effect on horns, and that this effect differs by species.</p>
</section><section id="step-5-understand-the-model-results-1" class="level3"><h3 class="anchored" data-anchor-id="step-5-understand-the-model-results-1">Step 5: understand the model results</h3>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">m1_hh</span>, <span class="op">~</span> <span class="va">treatment</span> <span class="op">|</span> <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/contrast.html">contrast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["species"],"name":[1],"type":["chr"],"align":["left"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["contrast"],"name":[3],"type":["chr"],"align":["left"]},{"label":["null.value"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["adj.p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"Onthophagus andalusicus","2":"treatment","3":"CT effect","4":"0","5":"0.0199301","6":"0.04579592","7":"73.45082","8":"0.4351939","9":"0.664697836"},{"1":"Onthophagus andalusicus","2":"treatment","3":"Q effect","4":"0","5":"-0.0199301","6":"0.04579592","7":"73.45082","8":"-0.4351939","9":"0.664697836"},{"1":"Onthophagus vacca","2":"treatment","3":"CT effect","4":"0","5":"-0.1164373","6":"0.03737660","7":"83.28862","8":"-3.1152453","9":"0.002520946"},{"1":"Onthophagus vacca","2":"treatment","3":"Q effect","4":"0","5":"0.1164373","6":"0.03737660","7":"83.28862","8":"3.1152453","9":"0.002520946"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We see that we have evidence that <em>O. vacca</em> relative horn size is on average larger in the Q treatment, but that there is no difference between treatments for <em>O. andalusicus</em> horns.</p>
</section><section id="step-6-visualise-model-predictions-alongside-raw-data-1" class="level3"><h3 class="anchored" data-anchor-id="step-6-visualise-model-predictions-alongside-raw-data-1">Step 6: visualise model predictions alongside raw data</h3>
<p>Here we plot the predicted head horn size for a given pronotum width, separately for each treatment x species combination (you will see there are four lines), along with the raw data.</p>
<p>Note: ideally we would include the estimated error around each line but I haven’t figured out how to do this for the type of model we have fitted here.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m1_hh</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pronotum_width</span>, y <span class="op">=</span> <span class="va">.fitted</span>, colour <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pronotum_width</span>, y <span class="op">=</span> <span class="va">head_horn</span>, colour <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Pronotum width (mm)"</span>, y <span class="op">=</span> <span class="st">"Head horn (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="hypothesis-2" class="level2"><h2 class="anchored" data-anchor-id="hypothesis-2">Hypothesis #2</h2>
<p>Now let’s investigate whether these effects persist across the generations.</p>
<p>Recall that our most complete data is for <em>Onthophagus vacca</em> shipments 2 and 4 up to generation 3. Let’s use just this data for this hypothesis for now.</p>
<p>Recall that we didn’t see an effect of the treatment on pronotum width for <em>O. vacca</em> in generation 1, but we did see an effect on head horns.</p>
<p>So, here we’ll focus just on head horns…</p>
<section id="step-1-prepare-the-data-1" class="level3"><h3 class="anchored" data-anchor-id="step-1-prepare-the-data-1">Step 1: prepare the data</h3>
<p>Filter the data to shipments 2 and 4 and remove the ‘parental’ generation.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Filter data</span></span>
<span><span class="va">db_data_F1_4</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">db_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">shipment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2"</span>, <span class="st">"4"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>                       <span class="va">generation</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#mutate(generation = as.factor(generation)) %&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check sample sizes</span></span>
<span><span class="va">db_data_F1_4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">head_horn</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">generation</span>, <span class="va">sex</span>, <span class="va">shipment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["treatment"],"name":[1],"type":["fct"],"align":["left"]},{"label":["generation"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[3],"type":["fct"],"align":["left"]},{"label":["shipment"],"name":[4],"type":["fct"],"align":["left"]},{"label":["n"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"CT","2":"1","3":"M","4":"2","5":"10"},{"1":"CT","2":"1","3":"M","4":"4","5":"11"},{"1":"CT","2":"2","3":"M","4":"2","5":"10"},{"1":"CT","2":"2","3":"M","4":"4","5":"15"},{"1":"CT","2":"3","3":"M","4":"2","5":"10"},{"1":"CT","2":"3","3":"M","4":"4","5":"15"},{"1":"CT","2":"4","3":"M","4":"2","5":"10"},{"1":"CT","2":"4","3":"M","4":"4","5":"10"},{"1":"Q","2":"1","3":"M","4":"2","5":"20"},{"1":"Q","2":"1","3":"M","4":"4","5":"10"},{"1":"Q","2":"2","3":"M","4":"2","5":"10"},{"1":"Q","2":"2","3":"M","4":"4","5":"9"},{"1":"Q","2":"3","3":"M","4":"2","5":"10"},{"1":"Q","2":"3","3":"M","4":"4","5":"10"},{"1":"Q","2":"4","3":"M","4":"2","5":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="step-2-fit-the-model-2" class="level3"><h3 class="anchored" data-anchor-id="step-2-fit-the-model-2">Step 2: fit the model</h3>
<p>By including an interaction between treatment and generation (treatment*generation in the model) we are asking if the treatment effect varies across generations.</p>
<p>Note that because here we have only two shipments, we have moved ‘shipment’ from being a random to a fixed effect. This is a detail that is not important at this stage, but please ask about this if you wish to discuss.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m2_hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">head_horn</span> <span class="op">~</span> <span class="va">pronotum_width</span> <span class="op">+</span> <span class="va">treatment</span><span class="op">*</span><span class="va">generation</span> <span class="op">+</span> <span class="va">shipment</span>,</span>
<span>              data <span class="op">=</span> <span class="va">db_data_F1_4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="step-3-check-model-assumptions-2" class="level3"><h3 class="anchored" data-anchor-id="step-3-check-model-assumptions-2">Step 3: check model assumptions</h3>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m2_hh</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="step-4-look-at-model-results-2" class="level3"><h3 class="anchored" data-anchor-id="step-4-look-at-model-results-2">Step 4: look at model results</h3>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">m2_hh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["int"],"align":["right"]},{"label":["Sum Sq"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Mean Sq"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["F value"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>F)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"6.889390e+01","3":"6.889390e+01","4":"6.950536e+02","5":"7.358253e-61","_rn_":"pronotum_width"},{"1":"1","2":"4.574447e-01","3":"4.574447e-01","4":"4.615047e+00","5":"3.316032e-02","_rn_":"treatment"},{"1":"1","2":"5.365254e-05","3":"5.365254e-05","4":"5.412873e-04","5":"9.814667e-01","_rn_":"generation"},{"1":"1","2":"1.344098e-02","3":"1.344098e-02","4":"1.356028e-01","5":"7.131671e-01","_rn_":"shipment"},{"1":"1","2":"1.118786e-02","3":"1.118786e-02","4":"1.128715e-01","5":"7.373278e-01","_rn_":"treatment:generation"},{"1":"164","2":"1.625572e+01","3":"9.912027e-02","4":"NA","5":"NA","_rn_":"Residuals"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>There is no evidence for a treatment by generation interaction (treatment:generation term in the anova output), but there is an effect of treatment. This suggests that there is a treatment effect (consistent with our earlier finding) and that this persists through time.</p>
<p>It could also mean that we lacked the power necessary to detect the interaction effect….</p>
</section><section id="step-5-understand-the-model-results-2" class="level3"><h3 class="anchored" data-anchor-id="step-5-understand-the-model-results-2">Step 5: understand the model results</h3>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/emmeans.html">emmeans</a></span><span class="op">(</span><span class="va">m2_hh</span>, <span class="op">~</span> <span class="va">treatment</span> <span class="op">|</span> <span class="va">generation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/emmeans/man/contrast.html">contrast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["generation"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["term"],"name":[2],"type":["chr"],"align":["left"]},{"label":["contrast"],"name":[3],"type":["chr"],"align":["left"]},{"label":["null.value"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["estimate"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["adj.p.value"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"2.317647","2":"treatment","3":"CT effect","4":"0","5":"-0.05025408","6":"0.02511557","7":"164","8":"-2.000913","9":"0.04705141"},{"1":"2.317647","2":"treatment","3":"Q effect","4":"0","5":"0.05025408","6":"0.02511557","7":"164","8":"2.000913","9":"0.04705141"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The Q beetles have larger horns relative to their body size compared to the CT beetles.</p>
</section><section id="step-6-visualise-model-predictions-alongside-raw-data-2" class="level3"><h3 class="anchored" data-anchor-id="step-6-visualise-model-predictions-alongside-raw-data-2">Step 6: visualise model predictions alongside raw data</h3>
<p>The following figure shows the predicted head horn size for a given pronotum width, along with the raw data, for each generation x shipment combination.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Strip labels are a little tricky to format. The following functions are used</span></span>
<span><span class="co"># in facet_grid below to aid with the labelling.</span></span>
<span><span class="va">appender_gen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">string</span>, <span class="va">prefix</span> <span class="op">=</span> <span class="st">"Generation: "</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="va">string</span><span class="op">)</span></span>
<span><span class="va">appender_ship</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">string</span>, <span class="va">prefix</span> <span class="op">=</span> <span class="st">"Shipment: "</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">prefix</span>, <span class="va">string</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Produce figure:</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m2_hh</span>, se_fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pronotum_width</span>, y <span class="op">=</span> <span class="va">.fitted</span>, colour <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">.fitted</span> <span class="op">-</span> <span class="va">.se.fit</span>, ymax <span class="op">=</span> <span class="va">.fitted</span> <span class="op">+</span> <span class="va">.se.fit</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pronotum_width</span>, y <span class="op">=</span> <span class="va">head_horn</span>, colour <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Pronotum width (mm)"</span>, y <span class="op">=</span> <span class="st">"Head horn (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Treatment"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">shipment</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,</span>
<span>             labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>generation <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="va">appender_gen</span><span class="op">)</span>,</span>
<span>                                 shipment <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/as_labeller.html">as_labeller</a></span><span class="op">(</span><span class="va">appender_ship</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="hypothesis-3" class="level2"><h2 class="anchored" data-anchor-id="hypothesis-3">Hypothesis #3</h2>
<p>We have found evidence that the treatment affected relative horn length and that this effect persisted for multiple generations.</p>
<p>Interestingly, there did not appear to be any effect of generation.</p>
<p>However, we used only a subset of the data in the above model. What if we use all the CT data we have that includes horn measures. This may increase our power to detect an effect of generation (i.e.&nbsp;does relative horn size change over time in ‘captive’ breeding).</p>
<section id="step-1-prepare-the-data-2" class="level3"><h3 class="anchored" data-anchor-id="step-1-prepare-the-data-2">Step 1: prepare the data</h3>
<p>Filter the data to <em>O. vacca</em> CT beetles.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">db_data_vac_CT</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">db_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Onthophagus vacca"</span> <span class="op">&amp;</span></span>
<span>           <span class="va">treatment</span> <span class="op">==</span> <span class="st">"CT"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check sample sizes</span></span>
<span><span class="va">db_data_vac_CT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">head_horn</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">treatment</span>, <span class="va">generation</span>, <span class="va">sex</span>, <span class="va">shipment</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["treatment"],"name":[1],"type":["fct"],"align":["left"]},{"label":["generation"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["sex"],"name":[3],"type":["fct"],"align":["left"]},{"label":["shipment"],"name":[4],"type":["fct"],"align":["left"]},{"label":["n"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"CT","2":"1","3":"M","4":"2","5":"10"},{"1":"CT","2":"1","3":"M","4":"4","5":"11"},{"1":"CT","2":"1","3":"M","4":"5A","5":"15"},{"1":"CT","2":"1","3":"M","4":"5B","5":"13"},{"1":"CT","2":"2","3":"M","4":"2","5":"10"},{"1":"CT","2":"2","3":"M","4":"4","5":"15"},{"1":"CT","2":"2","3":"M","4":"5A","5":"15"},{"1":"CT","2":"2","3":"M","4":"5B","5":"14"},{"1":"CT","2":"3","3":"M","4":"2","5":"10"},{"1":"CT","2":"3","3":"M","4":"4","5":"15"},{"1":"CT","2":"3","3":"M","4":"5A","5":"15"},{"1":"CT","2":"3","3":"M","4":"5B","5":"10"},{"1":"CT","2":"4","3":"M","4":"2","5":"10"},{"1":"CT","2":"4","3":"M","4":"4","5":"10"},{"1":"CT","2":"4","3":"M","4":"5A","5":"4"},{"1":"CT","2":"4","3":"M","4":"5B","5":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="step-2-fit-the-model-3" class="level3"><h3 class="anchored" data-anchor-id="step-2-fit-the-model-3">Step 2: fit the model</h3>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">m3_hh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span><span class="op">(</span><span class="va">head_horn</span> <span class="op">~</span> <span class="va">pronotum_width</span> <span class="op">+</span> <span class="va">generation</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">shipment</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">db_data_vac_CT</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="step-3-check-model-assumptions-3" class="level3"><h3 class="anchored" data-anchor-id="step-3-check-model-assumptions-3">Step 3: check model assumptions</h3>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">m3_hh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m3_hh</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="step-4-look-at-model-results-3" class="level3"><h3 class="anchored" data-anchor-id="step-4-look-at-model-results-3">Step 4: look at model results</h3>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/Anova.html">Anova</a></span><span class="op">(</span><span class="va">m3_hh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"511.1870154","2":"1","3":"3.499087e-113","_rn_":"pronotum_width"},{"1":"0.6175725","2":"1","3":"4.319508e-01","_rn_":"generation"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>There is no evidence for an effect of generation on horn length, but as in previous models there is a strong effect of pronotum width.</p>
</section><section id="step-5-understand-the-model-results-3" class="level3"><h3 class="anchored" data-anchor-id="step-5-understand-the-model-results-3">Step 5: understand the model results</h3>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">m3_hh</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["effect"],"name":[1],"type":["chr"],"align":["left"]},{"label":["group"],"name":[2],"type":["chr"],"align":["left"]},{"label":["term"],"name":[3],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"fixed","2":"NA","3":"(Intercept)","4":"-3.32858227","5":"0.20423888","6":"-16.2974960"},{"1":"fixed","2":"NA","3":"pronotum_width","4":"1.01003607","5":"0.04467319","6":"22.6094453"},{"1":"fixed","2":"NA","3":"generation","4":"-0.02053446","5":"0.02612999","6":"-0.7858578"},{"1":"ran_pars","2":"shipment","3":"sd__(Intercept)","4":"0.14497118","5":"NA","6":"NA"},{"1":"ran_pars","2":"Residual","3":"sd__Observation","4":"0.32039311","5":"NA","6":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We see there is a positive effect of pronotum width on horn length (see the positive estimate of the pronotum_width term). That is, as pronotum width increases, so does horn length.</p>
<p>Nothing surprising here - this was the reason we included pronotum width in the models in the first place.</p>
</section><section id="step-6-visualise-e-raw-data" class="level3"><h3 class="anchored" data-anchor-id="step-6-visualise-e-raw-data">Step 6: visualise e raw data</h3>
<p>If we want to visualise the relationship between pronotum width and horn length we can use the following:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">db_data_vac_CT</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pronotum_width</span>, y <span class="op">=</span> <span class="va">head_horn</span>, colour <span class="op">=</span> <span class="va">generation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Horn length (mm)"</span>, x <span class="op">=</span> <span class="st">"Pronotum width (mm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Generation"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="dung_beetles_data_modelling_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can see that as we increase generation (colours of the points), <em>O. vacca</em> males get larger horns but this is all down to them getting bigger!</p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../dung_beetles/dung_beetles_data_exploration.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Data exploration</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">© CC-By JD Berson, 2022</div>   
    <div class="nav-footer-right">This page is built with using <a href="https://quarto.org/">Quarto</a> using tips from an <a href="https://openscapes.github.io/quarto-website-tutorial/">openscapes tutorial</a>.</div>
  </div>
</footer>


</body></html>